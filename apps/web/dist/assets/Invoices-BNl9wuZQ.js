import{u as v,d as w,r as u,b as r,j as e}from"./index-CDXMD3eC.js";import{u as y}from"./useQuery-DAJvBtLK.js";import{u as m}from"./useMutation-7BwsYuZ6.js";function S(){const{currentWorkspace:s}=v(),l=w(),[i,h]=u.useState(""),[b,d]=u.useState(!1),[a,n]=u.useState({subscriberId:"",amount:"",dueDate:""}),{data:c,isLoading:p}=y({queryKey:["invoices",s==null?void 0:s.id,i],queryFn:()=>r.getInvoices(s.id,i||void 0),enabled:!!s}),{data:o}=y({queryKey:["subscribers",s==null?void 0:s.id],queryFn:()=>r.getSubscribers(s.id),enabled:!!s&&b}),x=m({mutationFn:t=>r.createInvoice(s.id,{subscriberId:t.subscriberId||null,amount:parseInt(t.amount)*100,dueDate:t.dueDate?Math.floor(new Date(t.dueDate).getTime()/1e3):null}),onSuccess:()=>{l.invalidateQueries({queryKey:["invoices"]}),d(!1),n({subscriberId:"",amount:"",dueDate:""})}}),j=m({mutationFn:r.payInvoice,onSuccess:()=>l.invalidateQueries({queryKey:["invoices"]})}),f=m({mutationFn:r.cancelInvoice,onSuccess:()=>l.invalidateQueries({queryKey:["invoices"]})}),g=(c==null?void 0:c.invoices)||[],N=t=>t?new Date(t*1e3).toLocaleDateString():"-";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Invoices"}),e.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white transition-colors",children:"+ Create Invoice"})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["","pending","paid","cancelled"].map(t=>e.jsx("button",{onClick:()=>h(t),className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${i===t?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:t||"All"},t))}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Invoice"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),x.mutate(a)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Subscriber (optional)"}),e.jsxs("select",{value:a.subscriberId,onChange:t=>n({...a,subscriberId:t.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"-- Select --"}),o==null?void 0:o.subscribers.map(t=>e.jsxs("option",{value:t.id,children:[t.username," - ",t.name||""]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Amount ($) *"}),e.jsx("input",{type:"number",value:a.amount,onChange:t=>n({...a,amount:t.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:a.dueDate,onChange:t=>n({...a,dueDate:t.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"flex-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x.isPending,className:"flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white disabled:opacity-50",children:x.isPending?"Creating...":"Create"})]})]})]})}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-gray-400",children:"ID"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-gray-400",children:"Subscriber"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-gray-400",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-gray-400",children:"Due Date"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-gray-400",children:"Status"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-medium text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400",children:"Loading..."})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400",children:"No invoices"})}):g.map(t=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-750",children:[e.jsxs("td",{className:"px-4 py-3 text-white font-mono text-sm",children:[t.id.slice(0,8),"..."]}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:t.subscriber_username||"-"}),e.jsxs("td",{className:"px-4 py-3 text-green-400 font-medium",children:["$",(t.amount/100).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:N(t.due_date)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t.status==="paid"?"bg-green-500/20 text-green-400":t.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-gray-500/20 text-gray-400"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.status==="pending"&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>j.mutate(t.id),className:"px-2 py-1 text-xs bg-green-600 hover:bg-green-700 rounded text-white",children:"Mark Paid"}),e.jsx("button",{onClick:()=>f.mutate(t.id),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded text-white",children:"Cancel"})]})})]},t.id))})]})})]})}export{S as default};
